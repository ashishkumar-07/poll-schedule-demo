InspectionSchedule.findScheduledInspectionsByDateRange=select sch.id as inspectionScheduleId, ent.id as inspectedEntityId, ent.name, ent.model,sch.status,trp.trip_start_time as tripStartTime,trp.trip_end_time as tripEndTime,sch.scheduled_start_time as scheduledStartTime,sch.scheduled_end_time as scheduledEndTime from inspection_schedule sch, inspection_trip trp,inspected_entity ent where sch.inspection_trip_id = trp.id and ent.id = ANY(sch.inspected_entities) and sch.scheduled_start_time >= :startTime and sch.scheduled_end_time <= COALESCE(:endTime,scheduled_end_time) order by scheduled_start_time desc
InspectionEvent.findEventsByInspectionDate=select inspected_entity_id as inspectedEntityId, ev.id as eventId, ent.name, ent.model, inspection_trip_id as inspectionTripId, inspection_status as inspectionStatus, event_date as eventDate, inspection_schedule_id as inspectionScheduleId, event_time as eventTime,inspection_status_progress as inspectionStatusProgress,inspection_report_id as inspectionReportId, null as nextInspectionDateTime, null as lastInspectionDateTime, event_type as eventType from (select * from (select id,inspected_entity_id, inspection_trip_id, inspection_status, event_date,inspection_schedule_id,event_time,inspection_status_progress,inspection_report_id,event_type, row_number() over (partition by inspected_entity_id order by event_date desc,event_time desc) as rownumber from inspection_event where event_date between :startDate and COALESCE(:endDate,event_date) ) ie where rownumber = 1) ev, inspected_entity ent where ev.inspected_entity_id=ent.id